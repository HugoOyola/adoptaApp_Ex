{% extends 'layout.html' %}

{% block content %}
<div class="container mt-4">

    <!-- =========================================================
         SECCIÓN: TÍTULO Y DATOS PRINCIPALES DE LA MASCOTA
         ---------------------------------------------------------
         TODO: Mostrar aquí el nombre de la mascota usando
               la variable de contexto 'mascota'.
         ========================================================= -->
    <h2>Galería de {{ mascota.nombre }}</h2>
    <p class="text-muted">Tipo: {{ mascota.tipo.nombre }} | Estado: {{ mascota.estado }}</p>

    <hr>

    <!-- =========================================================
         SECCIÓN: LISTA / GALERÍA DE POSTS DE LA MASCOTA
         ---------------------------------------------------------
         CONTEXTO:
         - La vista envía una variable 'posts' con la lista de
           publicaciones (PostMascota) asociadas a esta mascota.

         OBJETIVO:
         - Recorrer 'posts' con un bucle for y mostrar cada post
           en una tarjeta (card) o bloque simple.

         Dentro del for, mostrar:
              - Título del post
              - Fecha del post
              - Descripción del post
              - Imagen del post (campo foto)

         REVISAR VISTA DE DETALLE DE MASCOTA COMO REFERENCIA
         ========================================================= -->

    <div class="row">
        {% if posts %}
            {% for post in posts %}
            <div class="col-md-4 mb-4">
                <div class="card">
                    {% if post.foto %}
                    <img src="{{ post.foto.url }}" class="card-img-top" alt="{{ post.titulo }}" style="height: 250px; object-fit: cover;">
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ post.titulo }}</h5>
                        <p class="text-muted"><small>{{ post.fecha }}</small></p>
                        <p class="card-text">{{ post.descripcion }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="col-12">
                <div class="alert alert-info">
                    No hay publicaciones registradas para esta mascota aún.
                </div>
            </div>
        {% endif %}
    </div>


    <!-- =========================================================
         SECCIÓN: FORMULARIO PARA CREAR NUEVOS POSTS
         ---------------------------------------------------------
         CONTEXTO:
         - La vista, en la siguiente pregunta del examen, enviará
           un formulario 'form' basado en PostMascotaForm.

         OBJETIVO:
         - Mostrar el formulario dentro de la plantilla usando
           sintaxis de Django.
         ========================================================= -->

    <hr class="mt-4 mb-3">

    <h3>Registrar nuevo momento / publicación</h3>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        {% endif %}

        <div class="mb-3">
            {{ form.titulo.label_tag }}
            {{ form.titulo }}
            {% if form.titulo.errors %}
                <div class="text-danger">{{ form.titulo.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.descripcion.label_tag }}
            {{ form.descripcion }}
            {% if form.descripcion.errors %}
                <div class="text-danger">{{ form.descripcion.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.fecha.label_tag }}
            {{ form.fecha }}
            {% if form.fecha.errors %}
                <div class="text-danger">{{ form.fecha.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.foto.label_tag }}
            {{ form.foto }}
            {% if form.foto.errors %}
                <div class="text-danger">{{ form.foto.errors }}</div>
            {% endif %}
        </div>

        <button type="submit" class="btn btn-primary mt-2">Guardar publicación</button>
    </form>

    <!-- =========================================================
         SECCIÓN: BOTÓN PARA VOLVER
         ---------------------------------------------------------
         TODO: Opcionalmente, los alumnos pueden agregar un enlace
               para regresar a la ruta home de la app1
         ========================================================= -->

    <a href="{% url 'app1:home' %}" class="btn btn-secondary mt-3">Volver a inicio</a>


</div>
{% endblock %}
